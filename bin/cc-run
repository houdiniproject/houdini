#!/usr/bin/env bash

set -e

case "$1" in
  rails)
    shift  # Remove 'rails' from arguments
    docker-compose run --rm web rails "$@"
    ;;
  bundle)
    shift  # Remove 'bundle' from arguments
    docker-compose run --rm web bundle "$@"
    ;;
  yarn)
    shift  # Remove 'yarn' from arguments
    docker-compose run --rm web yarn "$@"
    ;;
  console|c)
    docker-compose run --rm web rails console
    ;;
  test|rspec|spec|t)
    docker-compose run --rm web bundle exec rspec "$@"
    ;;
  bash|sh)
    docker-compose run --rm web bash
    ;;
  worker)
    docker-compose run --rm worker bash
    ;;
  *)
    echo "Usage: bin/cc-run {rails|bundle|yarn|console|test|bash|worker} [args...]"
    echo ""
    echo "Generic commands:"
    echo "  rails [args]  - Run any rails command"
    echo "  bundle [args] - Run any bundle command"
    echo "  yarn [args]   - Run any yarn command"
    echo "  rspec [args]  - Run any rspec command"
    echo ""
    echo "Shortcuts:"
    echo "  console       - Rails console"
    echo "  test          - Run tests"
    echo "  bash          - Bash shell in web container"
    echo "  worker        - Bash shell in worker container"
    echo ""
    echo "Examples:"
    echo "  bin/cc-run rails db:migrate"
    echo "  bin/cc-run rails db:setup"
    echo "  bin/cc-run bundle install"
    echo "  bin/cc-run yarn install"
    exit 1
    ;;
esac
